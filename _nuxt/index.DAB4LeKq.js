import{_ as J}from"./Hamster.vue.BR5goSN8.js";import{_ as Q}from"./Preloader.BkUpjdeB.js";import{d as O,u as j,r as S,Z as H,o as u,a as m,e as t,b as e,w as N,a0 as ee,ad as F,ae as P,a1 as se,n as te,m as V,a3 as ae,i as ne,$ as k,c as re,q as oe,k as p,aa as w,C,F as E,D as B,t as U,l as le,a8 as ie,V as D,j as G}from"./entry.FoPbLsSY.js";import{_ as ce}from"./image.vue.kkg_s-zC.js";import{_ as ue}from"./Price.vue.BIy693gu.js";import{N as de,E as me,d as _e,S as ve}from"./effect-fade.fIDNg2TY.js";const ge={class:"user-avatar"},pe=["srcset"],fe=["src"],he=O({__name:"AvatarImage",props:{image:{},compressed:{}},setup(_){const f=_;j();const a=S(f.image),r=S(f.compressed??"");a.value||(a.value=H);function h(){a.value=H}return(c,l)=>(u(),m("div",ge,[t("picture",null,[e(r)?(u(),m("source",{key:0,srcset:e(r),type:"image/webp"},null,8,pe)):N("",!0),t("img",{src:e(a),onError:l[0]||(l[0]=y=>h())},null,40,fe)])]))}}),ye=ee("league",{state:()=>({rating:[],tab:F.MINERS,period:P.DAY,currentLevel:0}),actions:{async postGetUsers(_){return await se.post("/clicker/rank",{body:{level:_}}).then(f=>{const{level:a,myRank:r,topUsers:h}=f;if(this.rating.find(l=>l.level===a)){const l=this.rating.findIndex(v=>v.level===a),y={level:a,myRank:r??null,topUsers:h??[]};this.rating[l]=y}else{const l={level:a,myRank:r??null,topUsers:h??[]};this.rating.push(l)}return f}).catch(f=>{te.error({title:V().$i18n.t("messages.request_error"),message:V().$i18n.t("messages.no_rank")})})},setTab(_=F.MINERS){this.tab=_},setPeriod(_=P.DAY){this.period=_},setCurrentLevel(_=1){this.currentLevel=_}},getters:{}}),Le={class:"main"},ke={class:"inner league"},Se={class:"league-item"},$e={class:"league-item-image"},Ue={class:"league-data"},be={class:"league-data-name"},Ce={class:"league-numbers"},Ne=["innerHTML"],xe={class:"league-progress-outer"},Ae={key:0,class:"league-progress"},Ee={key:0,class:"league-users-progress"},Ie={class:"league-user-avatar"},Te={class:"league-user-info"},Me={class:"league-user-info-top"},Re={class:"league-user-position"},He=["innerHTML"],Fe={class:"league-user is-my",key:"myUser"},Pe={class:"league-user-avatar"},Ve={class:"league-user-info"},we={class:"league-user-info-top"},Be={class:"league-user-position"},ze=O({__name:"index",setup(_){const f=[de,me],a=S(null),r=ye(),h=ae(),c=ne(),l=j(),y=S([]),v=S(""),x=S(!1),K=Object.values(k).filter(s=>!isNaN(s)),b=S(""),q=s=>v.value?v.value.includes("+")?!1:parseInt(v.value)===s:!1,z=re(()=>!!v.value&&v.value.includes("+")),W=()=>{var n;const s=(n=a.value)==null?void 0:n.slides;if(s){const d=s.find(i=>i.classList.contains("swiper-slide-fully-visible"));let g=null;if(d){const i=d.classList;for(let L=0;L<i.length;L++){const $=i[L];if($.startsWith("is-")){g=$;break}}}if(b.value=g??"",g){const i=g.replace("is-","");T(i)!==r.currentLevel&&(r.setCurrentLevel(T(i)),I())}}},X=s=>{var n,d;a.value=s,b.value=`is-${A(k,((n=a==null?void 0:a.value)==null?void 0:n.activeIndex)+1)}`,r.setCurrentLevel(((d=a==null?void 0:a.value)==null?void 0:d.activeIndex)+1),I()},Y=s=>s>=c.getMaxUserLevel?`${G().t("friends.from")} ${l.numberFormat(c.getCoinsToLevelUpByLevel(s-1))}+`:c.level===s?`${l.numberFormat(c.balanceCoins??0)} / ${l.numberFormat(c.coinsToLevelUp??0)}`:`${G().t("friends.from")} ${l.numberFormat(c.getCoinsToLevelUpByLevel(s-1))}`,I=async()=>{const s=r.rating.find(n=>n.level===r.currentLevel);s?(y.value=s.topUsers,v.value=s.myRank??""):(x.value=!0,await r.postGetUsers(r.currentLevel).then(n=>{y.value=n.topUsers,v.value=n.myRank??""}).finally(()=>{x.value=!1}))};function A(s,n){return Object.keys(s).find(d=>s[d]===n)}function T(s){const n=Object.keys(k).filter(i=>typeof k[i]=="number"),d=n.map(i=>k[i]),g=n.indexOf(s);if(g!==-1)return d[g]}return oe(()=>{r.rating=[]}),(s,n)=>{var M,R;const d=J,g=Q,i=he,L=ce,$=ue;return u(),m("main",Le,[t("div",ke,[p(e(ve),{class:C(["league-slider",e(b)]),loop:!1,effect:"fade",onSwiper:X,navigation:"",modules:f,onSlideChange:W,initialSlide:e(c).level-1},{default:w(()=>[(u(!0),m(E,null,B(e(K),o=>(u(),le(e(_e),{class:C(["league-slide",`is-${A(e(k),o)}`]),key:o},{default:w(()=>[t("div",Se,[t("div",$e,[p(d,{level:o},null,8,["level"])])]),t("div",Ue,[t("div",be,U(A(e(k),o)),1)]),t("div",Ce,[t("span",{innerHTML:Y(o)},null,8,Ne)]),t("div",xe,[e(c).level===o?(u(),m("div",Ae,[t("div",{class:"league-progress-bar",style:ie({width:`${e(c).getProgressLevel}%`})},null,4)])):N("",!0)])]),_:2},1032,["class"]))),128))]),_:1},8,["initialSlide","class"]),t("div",{class:C(["league-users",e(b)])},[e(x)?(u(),m("div",Ee,[p(g)])):(u(),m(E,{key:1},[e(y).length>0?(u(!0),m(E,{key:0},B(e(y),(o,Z)=>(u(),m("div",{class:C(["league-user",{"is-my":q(o.rank)}]),key:`l${e(r).currentLevel}-${Z}`},[t("div",Ie,[p(i,{image:o.avatarUrl??""},null,8,["image"])]),t("div",Te,[t("div",Me,[p(L,{name:o.exchangeId??e(D).DEFAULT_EXCHANGE},null,8,["name"]),t("p",null,U(e(l).composeUsername(o.firstName,o.lastName,o.username)),1)]),p($,{price:o.earnPassivePerHour,round:!1},null,8,["price"])]),t("div",Re,U(o.rank),1)],2))),128)):e(y).length?N("",!0):(u(),m("p",{key:1,innerHTML:s.$t("league.no_users")},null,8,He)),e(z)?(u(),m("div",Fe,[t("div",Pe,[p(i,{image:(M=e(h).account_avatar)==null?void 0:M.defaultUrl,compressed:(R=e(h).account_avatar)==null?void 0:R.compressedUrl},null,8,["image","compressed"])]),t("div",Ve,[t("div",we,[p(L,{name:e(c).exchangeId??e(D).DEFAULT_EXCHANGE},null,8,["name"]),t("p",null,U(e(h).account_name),1)]),p($,{price:e(c).earnPassivePerHour??0,round:!1},null,8,["price"])]),t("div",Be,U(e(v)),1)])):N("",!0)],64))],2)])])}}});export{ze as default};
